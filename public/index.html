<html>

<style>
    #title {
        font-family: "Lucida Console", Monaco, monospace;
        font-size: 10px;
    }
    .logo {
     font-family: "Lucida Console", Monaco, monospace;
     font-size: 1px;
     float: left;
     padding: 10px;
     width: auto;
    }
</style>
<body>


<div style="display:block">
<pre class="logo">
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN0XMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWWMMMMMMMMMMMMMMMMMMMNx:oXMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNX0kxollcc::::::cclldxkKNMMMMMMNx, ,0MMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWXOdc;'..                   .dXMMMMNx,  .xWMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMWKxl,.                        .c0WMMMXx,    lNMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMN0o;.                ...........c0WMMMXx,     ;KMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMWKd;.           .':loxk00KXXXXXKK0XWMMMXx,      .kWMMW0kKWMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMWOc.          ':dOKNWMMMMMMMMMMMMMMMMMMXx,        oNMMMK, .l0WMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMNO:.        .;oONWMMMMMMMMMMMMMMMMMMMMMXx,         ;XMMMNc    .c0WMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMW0:.        ,o0WMMMMMMMMMMMMMMMMMMMMMMMXd,          'OMMMWx.      .cKWMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMXo.       .:kNMMMMMMMMMMMMMMMMMMMMMMMMXd'           .dWMMMWO:.       .dNMMMMMMMMMMMMMM
MMMMMMMMMMMMW0;       .:OWMMMMMMMMMMMMMMMMMMMMMMMX0d'             cXMMMMMMNO;.       :0WMMMMMMMMMMMM
MMMMMMMMMMMWx.       ,kNMMMMMMMMMMMMMMMMMMMMMMMXd'.              '0MMMMMMMMMNx'       'kWMMMMMMMMMMM
MMMMMMMMMMNd.      .oXMMMMMMMMMMMMMMMMMMMMMMMXd'                .xWMMMMMMMMMMMKl.      .xWMMMMMMMMMM
MMMMMMMMMNd.      .kWMMMMMMMMMMMMMMMMMMMMMMXd'                  lNMMMMMMMMMMMMMNx.      .xWMMMMMMMMM
MMMMMMMMWx.      'OWMMMMMMMMMMMMMMMMMMMMMXd'                   ;KMMMMMMMMMMMMMMMWk'      .kWMMMMMMMM
MMMMMMMMO'      'OWMMMMMMMMMMMMMMMMMMMWXd'                    .kWMMMMMMMMMMMMMMMMWk.      ,0MMMMMMMM
MMMMMMMX:      .xWMMMMMMMMMMMMMMMMMMMXd'                      oNMMMMMMMMMMMMMMMMMMWx.      lNMMMMMMM
MMMMMMWx.      lNMMMMMMMMMMMMMMMMMMXd'                       ;KMMMMMMMMMMMMMMMMMMMMNc      .kMMMMMMM
MMMMMMX:      '0MMMMMMMMMMMMMMMMWXd'                        'OMMMMMMMMMMMMMMMMMMMMMMO'      lNMMMMMM
MMMMMMO'      lNMMMMMMMMMMMMMMWXo'                          .coolooooooooooooodOWMMMNl      ,KMMMMMM
MMMMMWx.     .xMMMMMMMMMMMMMWKo'                                             'oKWMMMWx.     .OMMMMMM
MMMMMWo      'OMMMMMMMMMMMWKo.                                             'dXMMMMMMMO.     .xMMMMMM
MMMMMWl      '0MMMMMMMMMWKo.                                             'dXMMMMMMMMM0'     .xWMMMMM
MMMMMWl      '0MMMMMMMWKo.                                             ,dXMMMMMMMMMMM0'     .xWMMMMM
MMMMMWd.     .OMMMMMWKo.                                             ,xXMMMMMMMMMMMMMk.     .kMMMMMM
MMMMMMk.     .dWMMMWO:.................                            ,xNMMMMMMMMMMMMMMWd.     '0MMMMMM
MMMMMMK,      :XMMMWNXXXXXXXXXXXXXXXXXk,                         ;kNMMMMMMMMMMMMMMMMX:      cNMMMMMM
MMMMMMWo      .xWMMMMMMMMMMMMMMMMMMMMNl                       .;kNMMMMMMMMMMMMMMMMMWx.     .xWMMMMMM
MMMMMMM0'      ;KMMMMMMMMMMMMMMMMMMMWx.                     .;kNMMMMMMMMMMMMMMMMMMMK,      :XMMMMMMM
MMMMMMMWd.      cXMMMMMMMMMMMMMMMMMMO'                    .:ONMMMMMMMMMMMMMMMMMMMMXc      .kMMMMMMMM
MMMMMMMMXc      .lNMMMMMMMMMMMMMMMMK;                   .:OWMMMMMMMMMMMMMMMMMMMMMNl      .oNMMMMMMMM
MMMMMMMMMK;      .lXMMMMMMMMMMMMMMNl                  .cOWMMMMMMMMMMMMMMMMMMMMMMXc       cXMMMMMMMMM
MMMMMMMMMM0;       :0WMMMMMMMMMMMWd.                .c0WMMMMMMMMMMMMMMMMMMMMMMW0:       cXMMMMMMMMMM
MMMMMMMMMMMK:       .xNMMMMMMMMMMO.              .,l0WMMMMMMMMMMMMMMMMMMMMMMMNx.      .lXMMMMMMMMMMM
MMMMMMMMMMMMXl.       :OWMMMMMMMK;             .l0NWMMMMMMMMMMMMMMMMMMMMMMMWO;       .dNMMMMMMMMMMMM
MMMMMMMMMMMMMNx'       .cOWMMMMNc            .lKWMMMMMMMMMMMMMMMMMMMMMMMMNO:.       ,OWMMMMMMMMMMMMM
MMMMMMMMMMMMMMWKl.       ,KMMMWd.          .oKWMMMMMMMMMMMMMMMMMMMMMMMWXx;.       .oXMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMWO:.    .dWMMWO.         'oKWMMMMMMMMMMMMMMMMMMMMMMWXkc.        .c0WMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMWOc.  cNMMMK;        'dXMMMMMMMMMMMMMMMMMMMMMWXOd:.         .l0WMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMW0ooKMMMXc       'dXMMMMMMMMMMMMMMMMWWXKOdl;.           ,oKWMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMWMMMWd.     ,xXMMMWKoccllllllllc:;,..             'lONMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMWk.    ,xXMMMWKl.                          .;oONWMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMM0,   ,xNMMMW0l.                       .':okKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMXc  ;kNMMMMMNx:,...           ...',:ldkKNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMNd.;kNMMMMMMMMMWWXXK0OkkkkkkkOO0KXNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMKdONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMWWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM









</pre>
<pre id="title">
____    __    ____  ___       __       _______   ______       _______  __    __  .__   __.
\   \  /  \  /   / /   \     |  |     |       \ /  __  \     |   ____||  |  |  | |  \ |  |
 \   \/    \/   / /  ^  \    |  |     |  .--.  |  |  |  |    |  |__   |  |  |  | |   \|  |
  \            / /  /_\  \   |  |     |  |  |  |  |  |  |    |   __|  |  |  |  | |  . `  |
   \    /\    / /  _____  \  |  `----.|  '--'  |  `--'  |  __|  |     |  `--'  | |  |\   |
    \__/  \__/ /__/     \__\ |_______||_______/ \______/  (__)__|      \______/  |__| \__|
</pre>
</div>

<pre><h4>Info node:</h4></pre>
<pre id="info">
</pre>

<pre><h4>Follow Waldo:</h4></pre>
<pre>
  <a href="http://recksplorer.waldo.fun">Recksplorer</a>   <a href="http://shop.waldo.fun">Lightning Shop</a>   <a href="https://www.robtex.com/lightning/node/0392e78c508987c97de70b2474493e9b0dbbd0dcad69dec2648d686701da1df44a">Robtex</a>
  <a href="https://github.com/lvaccaro/waldo-stats">Fork on Github</a>   <a href="https://twitter.com/0xVaccaro">Twitter</a>
</pre>

<pre><h4>Direct channels:</h4></pre>
<pre id="channels">
</pre>

<pre><h4>List peers:</h4></pre>
<pre id="peers">
</pre>

<script>

    getinfo();


function getinfo() {
    var xhttp = new XMLHttpRequest();
    xhttp.open("GET", "http://waldo.fun:4000/getinfo", true);
    xhttp.onreadystatechange = function() {
        if (this.readyState === this.DONE) {

            //console.log(xhttp.responseText);
            info = JSON.parse(xhttp.responseText);
            info.alias = "Waldo.fun";
            printInfo(info);
            listpeers();
        }
    }
    xhttp.onerror = function (e) {
        console.error(xhr.statusText);
    };
    xhttp.send();
}

function listpeers() {
    var xhttp = new XMLHttpRequest();
    xhttp.open("GET", "http://waldo.fun:4000/listpeers", true);
    xhttp.onreadystatechange = function () {
        if (this.readyState === this.DONE) {

            //console.log(xhttp.responseText);
            peers = JSON.parse(xhttp.responseText).peers;
            //printPeers(peers);

            var channels = [];
            peers.forEach(function (p) {
                if (p.channels) {
                    p.channels.forEach(function (c) {
                        c.id = p.id;
                        channels.push(c);
                    });
                }
            });
            //printChannels(channels);

            listnodes(function(nodes){
                nodes.forEach(function (n) {
                    channels.forEach(function (c) {
                        if (n.nodeid == c.id) {
                            c.alias = n.alias;
                        }
                    });
                    peers.forEach(function (p) {
                        if (n.nodeid == p.id) {
                            p.alias = n.alias;
                        }
                    });
                });

                printPeers(peers);
                printChannels(channels);
            });
        }
    }
    xhttp.onerror = function (e) {
        console.error(xhr.statusText);
    };
    xhttp.send();
}


    function listnodes(callback) {
        var xhttp = new XMLHttpRequest();
        xhttp.open("GET", "http://waldo.fun:4000/listnodes", true);
        xhttp.onreadystatechange = function () {
            if (this.readyState === this.DONE) {

                //console.log(xhttp.responseText);
                nodes = JSON.parse(xhttp.responseText).nodes;
                callback(nodes);
            }
        }
        xhttp.onerror = function (e) {
            console.error(xhr.statusText);
        };
        xhttp.send();
    }


    function printInfo(info){
        var tag = document.getElementById("info");
        tag.innerHTML = "";
        var address;
        if (info.address && info.address.length>0 && info.address[0].address)
            address = info.address[0].address;

        tag.innerHTML = "\tnodeid: " + info.id+ "\n" +
            "\taddress: " + ((address)?address:'')+ "\n"+
            "\tport: " + info.port+ "\n"+
            "\talias: " + info.alias + "\n"+
            "\tversion: " + info.version+ "\n"+
            "\tblockheight: " + info.blockheight+ "\n"+
            "\tnetwork: " + info.network+ "\n";
    }


    function printPeers(peers){
        var tag = document.getElementById("peers");
        tag.innerHTML = "";
        peers.forEach(function (p) {
            tag.innerHTML += "\tnodeid: " + p.id + "\n" +
                ((p.alias)?("\talias: " + p.alias + "\n"):"") +
                "\tconnected: " + p.connected + "\n" +
                "\tstate: " + ((p.state) ? p.state : "NORMAL") + "\n" +
                "\tchannels: " + ((p.channels) ? p.channels.length : 0) + "\n\n";
        });
    }


    function printChannels(channels){
        var tag = document.getElementById("channels");
        tag.innerHTML = "";

        var count=0, capacityTotal=0, capacityUs=0;
        channels.forEach(function (c) {
            if (c.state == "CHANNELD_NORMAL"){
                count++;
                capacityUs += c.msatoshi_to_us;
                capacityTotal += c.msatoshi_total;

            }
        });
        tag.innerHTML += "Num channels : "+count+"\n";
        tag.innerHTML += "Your channel-side capacity : " + capacityUs+" msatoshi\n";
        tag.innerHTML += "Total capacity in channels : " + capacityTotal+" msatoshi\n\n";

        channels.forEach(function (c) {
            tag.innerHTML +=
                "\tchannelid: " + ((c.short_channel_id)?c.short_channel_id:'') + "\n" +
                "\tnodeid: " + c.id + "\n" +
                ((c.alias)?("\talias: " + c.alias + "\n"):"") +
                "\tfunding_txid: " + c.funding_txid + "\n" +
                "\tstate: " + c.state + "\n" +
                "\tmsatoshi: " + c.msatoshi_to_us + "/" + c.msatoshi_total + "\n" +
                "\tto_self_delay: " + c.to_self_delay + "\n\n";
        });
    }


</script>


</body>
</html>